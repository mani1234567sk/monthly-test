<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Result Management System</title>
  <style>
    body {
      font-family: Calibri, Arial, Helvetica, sans-serif;
      margin: 24px;
      color: #111;
      background: #fff;
      font-size: 11px;
    }
    .container {
      border: 1px solid #dcdcdc;
      max-width: 840px;
      margin: 0 auto;
      padding: 18px 22px;
    }
    .brand { text-align: center; }
    .brand .header-img { max-width: 360px; width: 100%; height: auto; display: block; margin: 0 auto 6px; }
    .report-title { text-align: center; font-weight: 600; font-size: 20px; }
    .term-field { text-align: center; font-weight: bold; margin: 10px 0 15px; font-size: 14px; }
    .section-heading { font-weight: 700; margin: 8px 0 6px; font-size: 14px; }
    .top { 
      display: grid;
      grid-template-columns: 1fr 135px;
      gap: 8px;
      align-items: start;
    }
    .photo { width: 120px; height: 120px; border: 1px solid #111; background: #0b5a7a; display: flex; align-items: center; justify-content: center; color: white; overflow: hidden; }
    .photo img { width: 100%; height: 100%; object-fit: cover; }
    .grid2 { display: grid; grid-template-columns: 1fr 1fr; gap: 6px 14px; }
    .kv { display: grid; grid-template-columns: 90px 1fr; align-items: center; }
    .kv label { font-size: 14px; color: #000; }
    input[type="text"], input[type="number"] { width: 100%; padding: 4px 6px; border: 1px dotted #777; font-size: 11px; }
    input[type="file"] { width: 100%; margin-top: 6px; }
    table.card { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 11px; border: 2px solid #111; table-layout: fixed; }
 
 
 
 
    table.card th, table.card td { border: 1px #777; padding: 6px 8px; text-align: center; }
    table.card th + th, table.card td + td { border-left: 1px solid #111; }
    table.card td:last-child { border-top: none; border-bottom: none; }
    table.card td:nth-child(3) input,
    table.card td:last-child input { border: none; width: 85%; padding: 4px 2px; background: transparent; }
    table.card td:nth-child(3) input:focus,
    table.card td:last-child input:focus { outline: none; }
    table.card thead th { border-bottom: 1px solid #111; }
    table.card td input { text-align: center; }
    table.card th { background: #f5f5f5; }
    .row-actions { display: flex; flex-wrap: nowrap; gap: 8px; justify-content: flex-start; margin-top: 12px; overflow-x: auto; padding: 6px 0; white-space: nowrap; min-height: 48px; align-items: center; }
    .row-actions button { flex: 1 1 auto; min-width: 100px; white-space: nowrap; }
    button { padding: 8px 12px; border: 1px solid #1f2937; background: #1f2937; color: white; cursor: pointer; border-radius: 4px; font-size: 11px; }
    button.secondary { background: white; color: #1f2937; }
    #status-message { margin-top: 16px; padding: 10px; border-radius: 4px; text-align: center; font-weight: bold; clear: both; }
    .remarks-input { width: 100%; border: none; border-bottom: 1px dotted #777; padding: 4px 0; background: transparent; font-size: 11px; }
    .signature-line { border-bottom: 1px dotted #777; height: 20px; }
    .photo-label { display: block; text-align: center; margin-top: 6px; font-size: 12px; color: #1f2937; cursor: pointer; }
    .principal-sign { display: flex; align-items: center; gap: 10px; }
    .principal-sign img { width: 150px; height: auto; }
    .donor-bar { background: #000; color: #fff; padding: 5px 0; font-weight: bold; font-size: 14px; margin: 25px 0 15px; display: flex; gap: 60px; align-items: center; justify-content: center; }
    .donor-bar input { font-size: 14px !important; }
    .footer { margin-top: 20px; text-align: center; font-size: 15px; color: #333; line-height: 1.6; }
    .footer .social { display: flex; justify-content: center; gap: 25px; flex-wrap: nowrap; margin-bottom: 8px; font-size: 15px; }
    .footer .address { font-size: 12px; color: #444; margin-top: 5px; }
    @media print {
      table.card th,
      table.card td {
        border: 1px #777 !important;
      }
   
      table.card th + th,
      table.card td + td {
        border-left: 1px solid #111 !important;
      }
     
    }
    @media print {
      /* remove dotted borders from all rows first */
      table.card tbody tr td {
        border-bottom: none !important;
      }
   
      /* FIRST VISIBLE DATA ROW dotted line */
      table.card tbody tr:first-child td {
        border-bottom: 1px #000 !important;
      }
   
      /* LAST ROW dotted line */
      table.card tbody tr:last-child td {
        border-bottom: 1px dotted #000 !important;
      }
   
      /* Keep header clean */
      table.card thead tr th {
        border-bottom: 1px solid #000 !important;
      }
    }
   
   
   
    /* PERFECT SINGLE-PAGE PRINT - NO BLANK PAGE */
       /* PERFECT SINGLE-PAGE PRINT - EXACTLY LIKE FRONTEND - NO EXTRA PAGE */
       @media print {
        @page {
          size: A4 portrait;
          margin: 0 !important;
        }
       
        html, body {
          margin: 0 !important;
          padding: 0 !important;
          width: 210mm !important;
          height: 297mm !important;
          overflow: hidden !important;
          background: white !important;
        }
 
        .container {
          border: none !important;
          padding: 0 12mm !important; /* Equal left & right margin */
          margin: 0 auto !important; /* Perfectly centered */
          width: 186mm !important; /* 210mm - 12mm left - 12mm right = 186mm */
          max-width: none !important;
          box-sizing: border-box !important;
        }
        .donor-bar {
          display: flex !important;
          flex-direction: row !important;
          justify-content: center !important;
          align-items: center !important;
          gap: 60px !important;
          background: black !important;
          color: white !important;
          padding: 5px 20px !important;
          -webkit-print-color-adjust: exact !important;
          print-color-adjust: exact !important;
        }
     
        /* Make sure Donor ID + Donor Name stay in one single line */
        .donor-bar div {
          display: flex !important;
          flex-direction: row !important;
          gap: 5px !important;
          white-space: nowrap !important; /* ====== IMPORTANT ====== */
          align-items: center !important;
        }
     
        /* Make the input text visible in print */
        .donor-bar input {
          color: white !important;
          background: transparent !important;
          font-weight: bold !important;
          border: none !important;
          width: auto !important;
          padding: 0 !important;
          margin: 0 !important;
          white-space: nowrap !important;
        }
        /* Hide all buttons & interactive elements */
        .no-print, .row-actions, input[type="file"], .photo-label, #status-message {
          display: none !important;
        }
 
        /* Clean inputs */
        input {
          border: none !important;
          background: transparent !important;
        }
 
        /* Table: only outer border */
        table.card {
          border: 2px solid #111 !important;
        }
      
       
        table.card th {
          background: transparent !important;
        }
 
        /* Keep photo alignment - removed negative margin for perfect equal margins */
        .top {
          margin-left: 0 !important;
        }
 
        /* Donor bar black background */
        .donor-bar {
          background: #000 !important;
          color: white !important;
          -webkit-print-color-adjust: exact !important;
          print-color-adjust: exact !important;
      
        }
        .donor-bar input {
          color: white !important;
          background: transparent !important;
          border: none !important;
          font-weight: bold !important;
        }
 
        /* Force exact colors */
        * {
          -webkit-print-color-adjust: exact !important;
          print-color-adjust: exact !important;
          color-adjust: exact !important;
        }
      }
  </style>
</head>
<body>
  <div class="container">
    <div class="brand">
      <div><br>
      </div>
      <img src="head-donor.PNG" alt="School Header" class="header-img" />
    </div>
    <div class="report-title">Progress Report</div>
    <form id="card-form">
      <div><br></div>
      <div><br></div>
      <div class="section-heading">Student Info:</div>
      <hr style="background:#000;height:1px;margin:8px 0;">
      <div class="top">
        <div>
          <div class="grid2">
            <div class="kv"><label for="RollNo" style="font-weight: bold; font-size:12px">USS ID:</label><input id="RollNo" name="roll" type="text" required /></div>
            <div class="kv"><label for="Name"style="font-weight: bold; font-size:12px">Student Name:</label><input id="Name" name="name" type="text" /></div>
         
            <div class="kv"><label for="Class"style="font-weight: bold; font-size:12px">Class:</label><input id="Class" name="class" type="text" /></div>
            <div class="kv"><label for="Session"style="font-weight: bold; font-size:12px">Session:</label><input id="Session" name="session" type="text" /></div>
            <div class="kv"><label for="Term" style="font-weight: bold; font-size:12px">Term:</label><input id="Term" name="Term" type="text" title="Term" /></div>
         
          </div>
        </div>
        <div style="margin-left: 15px;">
          <div class="photo"><img id="photoPreview" alt="Student Photo" /></div>
          <label for="studentPhoto" class="photo-label">Upload Photo</label>
          <input id="studentPhoto" name="photo" type="file" accept="image/*" onchange="onPhotoChange(event)" />
        </div>
      </div>
      <div><br></div>
      <div class="report-title">Scores</div>
      <table class="card">
        <thead><tr><th>S.NO</th><th>Subjects</th><th>Total Marks</th><th>Obtained Marks</th></tr></thead>
        <tbody id="subjects-tbody"></tbody>
      </table>
      <br>
      <div class="grid2">
        <div class="kv"><label for="Percentage"><b>Percentage:</b></label><u><input id="Percentage" name="Percentage" type="text" readonly /></u></div>
        <div class="kv"><label for="Grade" style="font-weight: bold;">Grade:</label><input id="Grade" name="Grade" type="text" readonly /></div>
      </div>
      <div class="grid2" style="gap:8px 14px; margin-top:10px;">
        <div class="kv" style="grid-column: 1 / span 2;">
          <label for="Remarks" style="font-weight: bold;">Remarks:</label>
          <input id="Remarks" name="remarks" type="text" class="remarks-input" />
        </div>
      </div>
      <div class="grid2" style="margin-top:8px; gap:8px 14px;">
        <div class="kv"><label style="font-weight: bold;">Teacher's Sign:</label><div class="signature-line"></div></div>
        <div class="kv"><label style="font-weight: bold;">Principal's Sign:</label>
          <div class="principal-sign">
            <img src="sign.PNG" alt="Principal Signature" />
            <div class="signature-line"></div>
          </div>
        </div>
      </div>
      <div><br></div>
      <div><br></div>
      <div class="donor-bar">
        <div style="margin-left: -30px;"> 
          <label style="color: white; font-weight: bold; white-space: nowrap; font-size: 16px;">
            Donor ID :
          </label> 
          <input title="DonorID" name="DonorID" type="text" value="" style="background:transparent;border:none;color:white;font-weight:bold;width:140px;">
        </div>
        <div> 
          <label style="color: white; font-weight: bold; white-space: nowrap; font-size: 16px;">
            Name :
          </label> 
          <input title="DonorName" name="DonorName" type="text" value="" style="background:transparent;border:none;color:white;font-weight:bold;width:260px;">
        </div>
      </div>
<div><br></div>
<div><br></div>
<div><br></div>
<div><br></div>
<div><br></div>




<div style="margin-top: 25px; text-align: center; font-size: 16px; color: #8d8888; line-height: 1.6;">
  <div style="display: flex; justify-content: center; gap: 20px; flex-wrap: nowrap; margin-bottom: 6px;">
    <span><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/51/Facebook_f_logo_%282019%29.svg/1280px-Facebook_f_logo_%282019%29.svg.png" alt="FB" style="width:12px;height:12px;"> /Uniqueschoolsystem1</span><p> </p><p> </p><p> </p>
    <span><img src="https://cdn-icons-png.flaticon.com/512/15/15874.png" alt="phone" style="width:12px;height:12px;"> +923445153406</span><p> </p><p> </p>
    <span><img src="https://cdn-icons-png.flaticon.com/512/732/732223.png" alt="email" style="width:12px;height:12px;"> uschools.pk@gmail.com</span>
  </div>
  <div style="font-size: 11px; color: #444;">
    Address : Unique school system, Main Lehtrar road, Punjgran, Islamabad, Pakistan.
  </div>
</div>
      <div class="row-actions no-print">
        <button type="button" class="secondary" onclick="clearForm()">New Student</button>
        <button type="button" class="secondary" onclick="loadByRoll()">Load Student</button>
        <button type="button" onclick="saveData()">Save Data</button>
        <button type="button" class="secondary" onclick="printCard()">Print Card</button>
      
        <button type="button" style="background-color: #f5f5f5;" ><a href="index.html">Simple Card</a></button>
       
      </div>
      <div id="status-message"></div>
    </form>
  </div>
  <script>
    const MARKS = {
      1: { default: 50, Nazra: 50 },
      2: { default: 50, Nazra: 50 },
      3: { default: 50, Nazra: 50 },
      4: { default: 50, Nazra: 50 },
      5: { default: 50, Nazra: 50 },
      6: { default: 50, Nazra: 50 },
      7: { default: 50, Nazra: 50 },
      8: { default: 50, Physics: 50, Chemistry: 50, Computer: 50, "Pakistan Studies": 50, Islamiat: 50, "Tarjama-tul-Quran": 50 },
      9: { default: 50, Physics: 50, Chemistry: 50, Computer: 50, "Pakistan Studies": 50, Islamiat: 50, "Tarjama-tul-Quran": 50 },
      10: { default: 50, Physics: 50, Chemistry: 50, Computer: 50, "Pakistan Studies": 50, Islamiat: 50 },
      11: { default: 50, "Pakistan Studies": 50, Islamiat: 50, "Tarjama-tul-Quran": 50 }
    };

    function getSubjectConfig(classInput) {
      const classStr = String(classInput).trim();
      const num = parseInt(classStr);
      const marks = MARKS[num] || { default: 50 };

      if (["Prep", "KG-II", "Nursery", "P.G","K.G-II", "0"].includes(classStr)) {
        return [
          {display:"English (Oral)", field:"EnglishOral", max:20},
          {display:"English (Written)", field:"English", max:30},
          {display:"Math (Oral)", field:"MathOral", max:20},
          {display:"Math (Written)", field:"Math", max:30},
          {display:"Urdu (Oral)", field:"UrduOral", max:20},
          {display:"Urdu (Written)", field:"Urdu", max:30},
          {display:"General Knowledge", field:"GeneralKnowledge", max:10},
          {display:"Drawing", field:"Drawing", max:20},
          {display:"Quraan Pak", field:"Nazra", max:20}
        ];
      }
      // Classes 1â€“7
      if (num >= 1 && num <= 7) {
        if (num <= 3) {
          return [
            {display: "Quraan Pak", field: "Nazra", max: marks.Nazra || 50},
            {display: "English", field: "English", max: marks.default},
            {display: "Urdu", field: "Urdu", max: marks.default},
            {display: "Mathematics", field: "Math", max: marks.default},
            {display: "Computer", field: "Computer", max: marks.default},
            {display: "General Knowledge", field: "GeneralKnowledge", max: marks.default},
            {display: "Islamiyat", field: "Islamiat", max: marks.default},
          ];
        }
        if (num <= 5) {
          return [
            {display: "Quraan Pak", field: "Nazra", max: marks.Nazra || 50},
            {display: "English", field: "English", max: marks.default},
            {display: "Urdu", field: "Urdu", max: marks.default},
            {display: "Mathematics", field: "Math", max: marks.default},
            {display: "Computer", field: "Computer", max: marks.default},
            {display: "Science", field: "Science", max: marks.default},
            {display: "Social Studies", field: "Sst", max: marks.default},
            {display: "Islamiyat", field: "Islamiat", max: marks.default},
          ];
        }
        return [
          {display: "English", field: "English", max: marks.default},
          {display: "Urdu", field: "Urdu", max: marks.default},
          {display: "Mathematics", field: "Math", max: marks.default},
          {display: "Science", field: "Science", max: marks.default},
          {display: "Computer", field: "Computer", max: marks.default},
          {display: "Geography", field: "Geography", max: marks.default},
          {display: "Islamiyat", field: "Islamiat", max: marks.default},
          {display: "Quraan Pak", field: "Nazra", max: marks.Nazra || 50},
        ];
      }
      // Arts Group - Exact string match
      if (classStr === "8 (Arts Group)" || classStr === "9 (Arts Group)" || classStr === "10 (Art Group)") {
        const config = [
          {display: "English", field: "English", max: marks.default},
          {display: "Urdu", field: "Urdu", max: marks.default},
          {display: "General Math", field: "Math", max: marks.default},
          {display: "General Science", field: "Science", max: marks.default},
          {display: "Islamiat Elective", field: "IslamiatElective", max: marks.default},
          {display: "Homeconomics", field: "Homeconomics", max: marks.default},
          {display: "Islamiyat", field: "Islamiat", max: marks.Islamiat || marks.default},
        ];
        if (classStr !== "10 (Art Group)") {
          config.push({display: "Tarjama-tul-Quran", field: "Tarjama", max: 50});
        }
        if (classStr === "10 (Art Group)") {
          config.push({display: "Pakistan Studies", field: "PakistanStudies", max: marks.PakistanStudies || marks.default});
        }
        return config;
      }
      // Science Group - When input is exactly "8", "9", or "10"
      if (classStr === "8" || classStr === "9" || classStr === "10") {
        const config = [
          {display: "English", field: "English", max: marks.default},
          {display: "Urdu", field: "Urdu", max: marks.default},
          {display: "Mathematics", field: "Math", max: marks.default},
          {display: "Biology/Computer", field: "Computer", max: marks.Computer || marks.default},
          {display: "Chemistry", field: "Chemistry", max: marks.Chemistry || marks.default},
          {display: "Physics", field: "Physics", max: marks.Physics || marks.default},
          {display: "Islamiyat", field: "Islamiat", max: marks.Islamiat || marks.default},
        ];
        if (num <= 9) config.push({display: "Tarjama-tul-Quran", field: "Tarjama", max: marks.Tarjama || 50});
        config.push({display: "Pakistan Studies", field: "PakistanStudies", max: marks.PakistanStudies || marks.default});
        return config;
      
      }
      if (classStr === "Tehfeez-ul-Quran") {
        return [
          {display: "English", field: "English", max: 50},
          {display: "Urdu", field: "Urdu", max: 50},
          {display: "Mathematics", field: "Math", max: 100},
          {display: "Quraan Pak", field: "Nazra", max: 50},
          {display: "Tajveed", field: "Tajveed", max: 50},
        ];
      }
      // Class 11 (overriding previous fallback for 11)
      if (classStr === "11") {
        return [
          {display: "English", field: "English", max: marks.default},
          {display: "Urdu", field: "Urdu", max: marks.default},
          {display: "Mathematics", field: "Math", max: marks.default},
          {display: "Computer", field: "Computer", max: marks.default},
          {display: "Statistics", field: "Statistics", max: marks.default},
          {display: "Pakistan Studies", field: "PakistanStudies", max: marks.PakistanStudies || 50},
          {display: "Islamiyat", field: "Islamiat", max: marks.Islamiat || 50},
          {display: "Tarjama-tul-Quran", field: "Tarjama", max: marks.Tarjama || 50},
        ];
      }
      // Default / fallback (for any other class)
      const config = [
        {display: "English", field: "English", max: marks.default},
        {display: "Urdu", field: "Urdu", max: marks.default},
        {display: "General Math", field: "Math", max: marks.default},
        {display: "General Science", field: "Science", max: marks.default},
        {display: "Islamiat Elective", field: "IslamiatElective", max: marks.default},
        {display:"Homeconomics", field: "Homeconomics", max: marks.default},
        {display: "Islamiyat", field: "Islamiat", max: marks.Islamiat || marks.default},
      ];
      if (num <= 9) config.push({display: "Tarjama-tul-Quran", field: "Tarjama", max: marks.Tarjama || 50});
      if (num > 9) config.push({display: "Pakistan Studies", field: "PakistanStudies", max: marks.PakistanStudies || marks.default});
    
      return config;
    }

    function renderSubjects(classInput, studentData = {}) {
      const tbody = document.getElementById('subjects-tbody');
      tbody.innerHTML = '';
      const config = getSubjectConfig(classInput);
      config.forEach((sub, i) => {
        const fieldKey = sub.field;
        const obtained = studentData[fieldKey] !== undefined ? studentData[fieldKey] : '';
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${i+1}</td>
          <td>${sub.display}</td>
          <td><input type="number" class="total-marks" value="${sub.max}" readonly style="background:transparent;border:none;width:60px;text-align:center;"></td>
          <td><input type="number" name="${fieldKey}" value="${obtained}" min="0" class="obtained-marks" style="width:70px;" onchange="calc()" oninput="calc()"></td>
        `;
        tbody.appendChild(tr);
      });
      const totalRow = document.createElement('tr');
      totalRow.innerHTML = `
        <td colspan="2"><hr><strong>Total</strong></td>
        <td id="MaxMarks" readonly><strong></strong></td>
        <td id="Total" readonly><strong>0</strong></td>
      `;
      tbody.appendChild(totalRow);
      calc();
    }
    function calc() {
      const rows = Array.from(document.querySelectorAll('table.card tbody tr'));
      let obtainedTotal = 0, maxTotal = 0;
      let passedAll = true;
      rows.slice(0, -1).forEach(tr => {
        const capInput = tr.querySelector('td:nth-child(3) input');
        const cap = capInput ? Math.max(0, Number(capInput.value) || 0) : 0;
        maxTotal += cap;
        const input = tr.querySelector('td:last-child input');
        let val = input ? Number(input.value) : 0;
        if (!Number.isFinite(val)) val = 0;
        const clamped = Math.max(0, Math.min(cap, val));
        if (input && clamped !== val) input.value = clamped;
        obtainedTotal += clamped;
        if (cap > 0) {
          const subjPerc = (clamped / cap) * 100;
          if (subjPerc < 40) passedAll = false;
        }
      });
      document.getElementById('MaxMarks').textContent = maxTotal;
      document.getElementById('Total').textContent = obtainedTotal;
      const percentage = maxTotal > 0 ? (obtainedTotal / maxTotal) * 100 : 0;
      document.getElementById('Percentage').value = percentage.toFixed(2) + '%';
      let grade = 'F';
      if (passedAll) {
        if (percentage > 85) grade = 'A+';
        else if (percentage > 71) grade = 'B';
        else if (percentage > 55) grade = 'C';
        else if (percentage >= 40) grade = 'D';
      } else {
        grade = 'F';
      }
      document.getElementById('Grade').value = grade;
    }
    async function loadByRoll() {
      const roll = document.getElementById('RollNo').value.trim();
      if (!roll) return alert('Enter USS ID / Roll No');
      try {
        const res = await fetch(`/student/${encodeURIComponent(roll)}`);
        if (!res.ok) throw new Error('Not found');
        const data = await res.json();
        document.getElementById('RollNo').value = data.roll || roll;
        document.getElementById('Name').value = data.Name || '';
        document.getElementById('Class').value = data.Class || '';
        document.getElementById('Term').value = data.Term || '';
      
        document.getElementById('Session').value = data.Session || '';
        document.getElementById('Remarks').value = data.Remarks || '';
        document.querySelector('input[name="DonorID"]').value = data['Donor ID'] || data.DonorID || '';
        document.querySelector('input[name="DonorName"]').value = data['Donor Name'] || data.DonorName || '';
        if (data.ImagePath) {
          document.getElementById('photoPreview').src = data.ImagePath;
        }
        renderSubjects(data.Class || 5, data);
        alert('Student loaded successfully!');
      } catch (e) {
        alert('Student not found');
      }
    }
    function clearForm() {
      document.getElementById('card-form').reset();
      document.getElementById('photoPreview').src = '';
      renderSubjects(5);
    }
    function onPhotoChange(e) {
      if (e.target.files[0]) {
        document.getElementById('photoPreview').src = URL.createObjectURL(e.target.files[0]);
      }
    }
    function printCard() { window.print(); }
    function openDonorCard() {
      const data = {
        roll: document.getElementById('RollNo').value,
        Name: document.getElementById('Name').value,
        Class: document.getElementById('Class').value,
        Session: document.getElementById('Session').value,
        Term:document.getElementById('Term').value,
        'Donor ID': document.querySelector('input[name="DonorID"]').value,
        'Donor Name': document.querySelector('input[name="DonorName"]').value,
        ImagePath: document.getElementById('photoPreview').src
      };
   
      document.querySelectorAll('#subjects-tbody input[name]').forEach(inp => {
        data[inp.name] = inp.value;
      });
   
      sessionStorage.setItem('donorCardData', JSON.stringify(data));
      window.open('donor-card.html?showDonorBar=true', '_blank');
    }
    async function saveData() {
      const form = document.getElementById('card-form');
      const formData = new FormData(form);
      document.querySelectorAll('.obtained-marks').forEach(inp => {
        formData.append(inp.name, inp.value);
      });
      formData.append('Percentage', document.getElementById('Percentage').value);
      formData.append('Grade', document.getElementById('Grade').value);
      formData.append('Donor ID', document.querySelector('input[name="DonorID"]').value);
      formData.append('Donor Name', document.querySelector('input[name="DonorName"]').value);
      try {
        const res = await fetch('/save', {
          method: 'POST',
          body: formData
        });
        if (res.ok) {
          document.getElementById('status-message').textContent = 'Saved successfully!';
          document.getElementById('status-message').style.color = 'green';
        } else {
          throw new Error('Save failed');
        }
      } catch (e) {
        document.getElementById('status-message').textContent = 'Error saving: ' + e.message;
        document.getElementById('status-message').style.color = 'red';
      }
    }
    async function generatePDF() {
      const roll = document.getElementById('RollNo').value.trim();
      if (!roll) return alert('Enter Roll No');
      const formData = new FormData();
      formData.append('roll', roll);
      try {
        const res = await fetch('/generate-pdf', {
          method: 'POST',
          body: formData
        });
        if (!res.ok) throw new Error('Failed');
        const blob = await res.blob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `Result_${roll}.pdf`;
        a.click();
        URL.revokeObjectURL(url);
      } catch (e) {
        alert('Error: ' + e.message);
      }
    }
    async function generateDOCX() {
      const roll = document.getElementById('RollNo').value.trim();
      if (!roll) return alert('Enter Roll No');
      const formData = new FormData();
      formData.append('roll', roll);
      try {
        const res = await fetch('/generate', {
          method: 'POST',
          body: formData
        });
        if (!res.ok) throw new Error('Failed');
        const blob = await res.blob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `Result_${roll}.docx`;
        a.click();
        URL.revokeObjectURL(url);
      } catch (e) {
        alert('Error: ' + e.message);
      }
    }
    window.onload = () => {
      document.getElementById('Class').addEventListener('change', () => {
        const classNum = document.getElementById('Class').value;
        renderSubjects(classNum);
      });
      renderSubjects(5);
    };
  </script>
</body>
</html>